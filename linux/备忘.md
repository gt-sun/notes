[TOC]


### Centos 7 重置密码


- 1

重启Linux CentOS 7系统，在下图中用方向键选择对应的系统，并按“e”键。

- 2

按“ctrl+e”移动到最后，删除“rhgb quiet LANG=zh_CN.UTF-8”,输入“init=/bin/sh”，按“ctrl+x”引导系统。

- 3

输入“mount -o remount, rw /”并按回车键确定使文件系统为可写。

- 4

输入“passwd”修改密码（需输入两次密码），成功后出现如下提示：all authentication tokens updated successfully.

- 5 

输入“touch /.autorelabel”确保重启后系统正确恢复。

- 6

输入“exec /sbin/init”重新初始化。



### source 和 bash 的区别

source (或者.)：在当前bash环境下执行命令；
bash（或者sh）：启动一个子shell执行命令；

### Linux内存


free命令的buffer/cache的解释和作用：


buffer：
块设备缓存block cache，主要用作io的写操作；


cache：
页面缓存page cache，主要用作io的读操作；




在tmpfs中（/dev/shm）的文件会占用page cache，且不可被回收，直到文件删除。




当 cache 作为文件缓存被释放的时候会引发 IO 变高，这是 cache 加快文件访问速度所要付出的成本。


### 小优化


```
vi /etc/profile
alias grep='grep --color=auto'
export GREP_COLOR='1;33'   #37白色  33黄色

alias vi='vim'
alias screen='TERM=screen screen'

```


```
#sshd服务
egrep "GSS|DNS" /etc/ssh/sshd_config
sed -i "s/GSSAPIAuthentication yes/GSSAPIAuthentication no/g" /etc/ssh/sshd_config 
sed -i "s/#UseDNS yes/UseDNS no/g" /etc/ssh/sshd_config
/etc/init.d/sshd restart
```


### 网卡配置

```
cd /etc/sysconfig/network-scripts

cat > ifcfg-eth0 << EOF
DEVICE=eth0
HWADDR=08:00:27:2A:52:2C
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=192.168.1.181
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1=223.5.5.5
DNS2=223.6.6.6
EOF
```





### 以xx用户运行

```
法1
sudo -u sun nc -l 20001
法2
su - sun -c "nc -l 20002"
```

第一种是在当前bash下运行，当bash退出后，命令终止；
第二种是直接在ppid 1 下面新建一个进程，bash退出后继续存在。

### 为普通用户设置bash

```
vim /hoem/hero/.bash_profile
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l='ls -CF'
alias la='ls -A'
alias ll='ls -alF'
alias ls='ls --color=auto'
```

**注：系统新建用户时，会把/etc/skel/下面的配置文件同步到用户家目录；**



### 通过lsof恢复文件

```
# lsof |grep delete
syslogd   1283      root    2w      REG        3,3  5381017    1773647 /var/log/messages (deleted)
ll -h /proc/1283/fd/
total 0
lrwx------ 1 nobody nobody 64 Oct 20 05:03 0 -> /dev/null
lrwx------ 1 nobody nobody 64 Oct 20 05:03 1 -> /dev/null
lrwx------ 1 nobody nobody 64 Oct 20 05:03 10 -> [eventpoll]
lrwx------ 1 nobody nobody 64 Oct 20 05:03 11 -> [eventfd]
l-wx------ 1 nobody nobody 64 Oct 20 05:03 2 ->  (deleted)/usr/local/openresty/nginx/logs/error.log
```

从上面的信息可以看出，查看 /proc/8663/fd/2 就可以得到所要恢复的数据。
```
cat /proc/1283/fd/2 > /var/log/messages
```
对于许多应用程序，尤其是日志文件和数据库，这种恢复删除文件的方法非常有用。

### rsync删除文件

```
rsync -a --delete /dev/shm/sun2/ /dev/shm/sun/ 
#前一个是空目录，后一个是要删除文件的目录
```

### 导出man文档

```
man grep |col -b > grep.man.log
```

### 查看使用语言

查看当前使用语言：locale
使用中文：export LANG=zn_CN.GB18030



### 关闭某个用户的登录session

1，查明登陆端口；
```
# who
root pts/1 Apr 8 00:06 (172.29.0.29)
root pts/2 Apr 8 04:15 (172.29.0.21)
```
2，通知该用户将要关闭他：
```
# echo "I will close your connection" > /dev/pts/2
```
3，关闭用户连接
```
# fuser -k /dev/pts/2
或者直接kill
pkill -kill -t pts/5
```

### while 读取文件

while循环是用来逐行读取文件最恰当且最简单的方法：
```
while read line; do echo $line; done < file.txt
```


```
#保留文件最新100行：
echo `tail -n100 /tmp/dummy.log` > /tmp/dummy.log
```


### 开机加载模块

rc.sysinit中有这样的一段代码：

```
# Load other user-defined modules
for file in /etc/sysconfig/modules/*.modules ; do
[ -x $file ] && $file
done

# Load modules (for backward compatibility with VARs)
if [ -f /etc/rc.modules ]; then
/etc/rc.modules
fi
```

可见只需要配置两个地方的任何一个就可以了（以加载fuse内核模块为例）
(1) 在/etc/sysconfig/modules/下面创建*.modules文件，参考已经有的*.modules文件，
例如我写创建文件my.modules，内容为modprobe fuse
记得最后chmod 755 my.modules
(2) 或者在/etc/rc.modules里面加上modprobe fuse，没有的话创建该文件。
然后reboot，lsmod | grep fuse验证一下就OK了。


### 权限解释
|-|对文件|对目录|
|--|--|--|
|r 4|可读|可列出|
|w 2|可修改|可在目录中新建、删除文件|
|x 1|可执行|可进入目录|


### 查看系统安装时间
```
passwd -S root
```
在linux下，由于root、bin、daemon等账号就是在系统安装时创建的，因此这些帐号的创的时间基本上就是 Linux 系统的安装时间


### 挂载windows下的共享文件夹

```
yum install cifs* ；
mount -t cifs //192.168.1.102/studyshare /mnt -o username=chocolee，password=yourpass
```